---
title: "sum_and_plot"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Run if UCloud instance is fresh
```{r}
install.packages("pacman")
```

### Load packages and functions
```{r}
library(pacman)
p_load(tidyverse,gdtools, ggplot2, ggthemes, Hmisc, ggpubr, patchwork, stringr)
# setwd("/work/Exam/decision_making")
source("post_sim_functions.R")
```

### Get folders, read data and sum
List folder
```{r}
folders = list.dirs(file.path("data"))
folders = folders[2:length(folders)]
folders
```

Sum data
```{r}
out = sum_multiple_results(folders)
data_summed = out[[1]]
degree_distribution = out[[2]]
point_estimates = out[[3]]
```

### Result plots
Baseline
```{r}
data_summed %>% subset(baseline==T) %>% 
  plot_standard_by_name(title = "Baseline simulations")
```

High status = 0.5
```{r}
data_summed %>% subset(status == "0.5") %>% plot_standard_by_name(title="High status = 0.5% of tau")
```

High status = 0.75
```{r}
data_summed %>% subset(status == "0.75") %>% plot_standard_by_name(title="High status = 0.75% of tau")
```

High status = 1
```{r}
data_summed %>% subset(status == "1") %>% plot_standard_by_name(title="High status = 100% of tau")
```

High degree = 24 connections
```{r}
data_summed %>% subset(degree == "24") %>% plot_standard_by_name(title = "High degree = 24 connections")
```

High degree = 48 connections
```{r}
data_summed %>% subset(degree == "48") %>% plot_standard_by_name(title = "High degree = 48 connections")
```

High degree = 96 connections
```{r}
data_summed %>% subset(degree == "96") %>% plot_standard_by_name(title = "High degree = 96 connections")
```




### Degree distribution plots

Getting mean degree under different conditions
```{r}
#Maybe we dont want this??
means_baseline <- degree_distribution %>% subset(baseline==T) %>% mean_degree()

#This is just all simulation where high degree = FALSE, so they should all have similar degree
means_standard <- degree_distribution %>% subset(degree==F) %>% mean_degree()

#The different high degree conditions - what makes sense here? In a way we need all nine combinations. Maybe just the one above actually
means_high_degree_24 <- degree_distribution %>% subset(degree=="24") %>% mean_degree()
means_high_degree_48 <- degree_distribution %>% subset(degree=="48") %>% mean_degree()
means_high_degree_96 <- degree_distribution %>% subset(degree=="96") %>% mean_degree()
```

plotting baseline
```{r}
degree_baseline_plot <- plot_degree_distribution(means_baseline, title ="Baseline simulations")
degree_baseline_plot
ggsave("degree_distribution_baseline.png", degree_baseline_plot, width = 12, height = 6)
```

plotting standard, i.e., high degree = FALSE
```{r}
degree_standard_plot <- plot_degree_distribution(means_standard, title = "Standard degree distribution")
degree_standard_plot
ggsave("degree_distribution_standard.png", degree_standard_plot, width = 12, height = 6)
```

plotting high degree = TRUE
```{r}

```



























### Point estimates

```{r}
calculate_point_estimates <- function(data){
  # data should be summed before this function
  q25=filter(data, sumadopt >= 22500*0.25) %>% group_by(network) %>% summarise(minround = min(round))
  q25_mean = round(mean(q25$minround),0)
  q25_sd   = round(sd(q25$minround),2)
  q50=filter(data, adopters >= 22500*0.50) %>% group_by(network) %>% summarise(minround = min(round))
  q50_mean = round(mean(q50$minround),0)
  q50_sd   = round(sd(q50$minround),2)
  q75=filter(data, adopters >= 22500*0.75) %>% group_by(network) %>% summarise(minround = min(round))
  q75_mean = round(mean(q75$minround),0)
  q75_sd   = round(sd(q75$minround),2)
  q99=filter(data, adopters >= 22500*0.99) %>% group_by(network) %>% summarise(minround = min(round))
  q99_mean = round(mean(q99$minround),0)
  q99_sd   = round(sd(q99$minround),2)
  all <- data.frame(
    name = data$name[1],
    mean_25 = q25_mean,
    sd_25   = q25_sd,
    mean_50 = q50_mean,
    sd_50   = q50_sd,
    mean_75 = q75_mean,
    sd_75   = q75_sd,
    mean_99 = q99_mean,
    sd_99   = q99_sd
  )
  return(all)
}
```

### See point estimates
```{r}
View(point_estimates)
```

